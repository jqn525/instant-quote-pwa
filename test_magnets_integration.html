<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Magnets Integration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { border-color: green; background-color: #f0f8f0; }
        .error { border-color: red; background-color: #f8f0f0; }
        #product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .product-card { padding: 20px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; text-align: center; }
        .product-card:hover { border-color: #2563eb; }
        .product-card.selected { border-color: #2563eb; background-color: #f0f8ff; }
        .product-icon { font-size: 2rem; margin-bottom: 10px; }
        .product-name { margin: 0 0 10px 0; font-size: 1.2em; }
        .product-description { color: #666; font-size: 0.9em; }
        .interpolation-badge { 
            background: orange; 
            color: white; 
            padding: 2px 6px; 
            border-radius: 3px; 
            font-size: 0.8em; 
            margin-left: 10px; 
        }
    </style>
</head>
<body>
    <h1>Magnets Integration Test</h1>
    <div id="status">Loading...</div>
    <div id="product-grid"></div>

    <script type="module">
        try {
            // Test imports
            const { productTypes } = await import('./src/data/products.js');
            const { createSvgIcon } = await import('./src/components/SvgIcons.js');
            const { ExternalPricingEngine } = await import('./src/services/ExternalPricingEngine.js');
            
            document.getElementById('status').innerHTML = '<div class="test-result success">✓ All imports successful!</div>';
            
            const container = document.getElementById('product-grid');
            console.log('Products loaded:', Object.keys(productTypes));
            
            // Test each product
            Object.entries(productTypes).forEach(([key, product]) => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.dataset.productKey = key;
                
                // Get icon
                let productIcon = '';
                switch (key) {
                    case 'brochures':
                        productIcon = createSvgIcon('brochure');
                        break;
                    case 'postcards':
                        productIcon = createSvgIcon('postcard');
                        break;
                    case 'flyers':
                        productIcon = createSvgIcon('flyer');
                        break;
                    case 'bookmarks':
                        productIcon = createSvgIcon('bookmark');
                        break;
                    case 'table_tents':
                        productIcon = createSvgIcon('table_tent');
                        break;
                    case 'magnets':
                        productIcon = createSvgIcon('magnet');
                        break;
                    default:
                        productIcon = createSvgIcon('businessCard');
                }
                
                const isInterpolation = product.pricing.type === 'interpolation';
                
                productCard.innerHTML = `
                    <div class="product-icon">${productIcon}</div>
                    <h4 class="product-name">
                        ${product.name}
                        ${isInterpolation ? '<span class="interpolation-badge">Interpolation</span>' : ''}
                    </h4>
                    <p class="product-description">${product.description}</p>
                    <small>Sizes: ${Object.keys(product.sizes).length}</small>
                `;
                
                // Test pricing for interpolation products
                if (isInterpolation) {
                    const engine = new ExternalPricingEngine();
                    const pricing = engine.calculatePrice(product, '2X2', 50);
                    
                    const priceInfo = document.createElement('div');
                    priceInfo.style.marginTop = '10px';
                    priceInfo.style.fontSize = '0.8em';
                    priceInfo.style.color = '#007700';
                    priceInfo.innerHTML = `<strong>Test Price (50×2X2):</strong> $${pricing.total.toFixed(2)}`;
                    productCard.appendChild(priceInfo);
                }
                
                productCard.addEventListener('click', () => {
                    // Remove previous selection
                    document.querySelectorAll('.product-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    
                    // Select this card
                    productCard.classList.add('selected');
                    
                    console.log('Selected product:', key, product);
                    
                    // Show product details
                    const status = document.getElementById('status');
                    status.innerHTML = `
                        <div class="test-result success">
                            <strong>Selected:</strong> ${product.name}<br>
                            <strong>Type:</strong> ${product.pricing.type || 'standard'}<br>
                            <strong>Sizes:</strong> ${Object.keys(product.sizes).join(', ')}<br>
                            ${isInterpolation ? `<strong>Min Qty:</strong> ${product.pricing.minQuantity}` : ''}
                        </div>
                    `;
                });
                
                container.appendChild(productCard);
            });
            
            // Test magnets specifically
            const magnets = productTypes.magnets;
            if (magnets && magnets.pricing.type === 'interpolation') {
                const engine = new ExternalPricingEngine();
                const test75 = engine.calculatePrice(magnets, '2X2', 75);
                const test350 = engine.calculatePrice(magnets, '3X3', 350);
                
                const testResults = document.createElement('div');
                testResults.innerHTML = `
                    <div class="test-result success">
                        <h3>Magnets Pricing Test</h3>
                        <p><strong>75×2X2:</strong> $${test75.total.toFixed(2)} (Expected: ~$101.25)</p>
                        <p><strong>350×3X3:</strong> $${test350.total.toFixed(2)} (Expected: ~$490.25)</p>
                    </div>
                `;
                document.body.appendChild(testResults);
            }
            
        } catch (error) {
            document.getElementById('status').innerHTML = `<div class="test-result error">Error: ${error.message}</div>`;
            console.error('Error:', error);
        }
    </script>
</body>
</html>