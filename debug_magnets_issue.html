<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Magnets Issue</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #ddd; border-radius: 8px; }
        .success { border-color: green; background-color: #f0f8f0; }
        .error { border-color: red; background-color: #f8f0f0; }
        .warning { border-color: orange; background-color: #fff8f0; }
        .info { border-color: blue; background-color: #f0f0f8; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .product-test { 
            display: inline-block; 
            margin: 5px; 
            padding: 10px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            min-width: 100px;
            text-align: center;
        }
        .magnets { background-color: #ffe6cc; }
    </style>
</head>
<body>
    <h1>üîç Debug: Why Magnets Aren't Showing</h1>
    
    <div id="step1" class="test-section info">
        <h3>Step 1: Module Import Test</h3>
        <p>Testing if products.js can be imported and what it contains...</p>
        <div id="import-result">Loading...</div>
    </div>

    <div id="step2" class="test-section info">
        <h3>Step 2: SVG Icon Test</h3>
        <p>Testing if magnet SVG icon can be created...</p>
        <div id="icon-test">Loading...</div>
    </div>

    <div id="step3" class="test-section info">
        <h3>Step 3: Product Rendering Test</h3>
        <p>Testing ProductSelector rendering...</p>
        <div id="product-test">Loading...</div>
    </div>

    <div id="step4" class="test-section info">
        <h3>Step 4: Error Detection</h3>
        <p>Checking for JavaScript errors...</p>
        <div id="error-test">Loading...</div>
    </div>

    <div id="step5" class="test-section info">
        <h3>Step 5: Individual Product Test</h3>
        <div id="individual-products">Loading...</div>
    </div>

    <script type="module">
        // Capture any errors
        const errors = [];
        window.addEventListener('error', (e) => {
            errors.push(e.error);
            console.error('Captured error:', e.error);
        });

        // Step 1: Module Import Test
        try {
            const { productTypes } = await import('./src/data/products.js?v=' + Date.now());
            const products = Object.keys(productTypes);
            
            document.getElementById('import-result').innerHTML = `
                <div class="${products.includes('magnets') ? 'success' : 'error'}">
                    <strong>Products found:</strong> ${products.length}<br>
                    <strong>List:</strong> ${products.join(', ')}<br>
                    <strong>Magnets included:</strong> ${products.includes('magnets') ? '‚úÖ YES' : '‚ùå NO'}
                </div>
                <pre>${JSON.stringify(productTypes.magnets || 'Magnets not found', null, 2)}</pre>
            `;
            document.getElementById('step1').className = 'test-section ' + (products.includes('magnets') ? 'success' : 'error');
        } catch (error) {
            document.getElementById('import-result').innerHTML = `<div class="error">Import failed: ${error.message}</div>`;
            document.getElementById('step1').className = 'test-section error';
            errors.push(error);
        }

        // Step 2: SVG Icon Test
        try {
            const { createSvgIcon } = await import('./src/components/SvgIcons.js');
            const magnetIcon = createSvgIcon('magnet');
            const brochureIcon = createSvgIcon('brochure');
            
            document.getElementById('icon-test').innerHTML = `
                <div class="success">
                    <p><strong>Brochure icon:</strong> ${brochureIcon ? '‚úÖ' : '‚ùå'}</p>
                    <p><strong>Magnet icon:</strong> ${magnetIcon ? '‚úÖ' : '‚ùå'}</p>
                    <div>Magnet icon preview: ${magnetIcon}</div>
                </div>
            `;
            document.getElementById('step2').className = 'test-section success';
        } catch (error) {
            document.getElementById('icon-test').innerHTML = `<div class="error">Icon test failed: ${error.message}</div>`;
            document.getElementById('step2').className = 'test-section error';
            errors.push(error);
        }

        // Step 3: Product Rendering Test
        try {
            const { productTypes } = await import('./src/data/products.js?v=' + Date.now());
            const { ProductSelector } = await import('./src/components/ProductSelector.js');
            
            const testContainer = document.createElement('div');
            testContainer.style.display = 'grid';
            testContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(200px, 1fr))';
            testContainer.style.gap = '10px';
            
            const selector = new ProductSelector(testContainer, productTypes, (product) => {
                console.log('Product selected:', product);
            });
            
            document.getElementById('product-test').appendChild(testContainer);
            
            const renderedProducts = testContainer.querySelectorAll('.product-card').length;
            const magnetCard = testContainer.querySelector('[data-product-key="magnets"]');
            
            const resultDiv = document.createElement('div');
            resultDiv.className = magnetCard ? 'success' : 'error';
            resultDiv.innerHTML = `
                <p><strong>Cards rendered:</strong> ${renderedProducts}</p>
                <p><strong>Magnets card found:</strong> ${magnetCard ? '‚úÖ YES' : '‚ùå NO'}</p>
            `;
            document.getElementById('product-test').insertBefore(resultDiv, testContainer);
            document.getElementById('step3').className = 'test-section ' + (magnetCard ? 'success' : 'error');
            
        } catch (error) {
            document.getElementById('product-test').innerHTML = `<div class="error">ProductSelector test failed: ${error.message}</div>`;
            document.getElementById('step3').className = 'test-section error';
            errors.push(error);
        }

        // Step 4: Error Detection
        setTimeout(() => {
            document.getElementById('error-test').innerHTML = `
                <div class="${errors.length === 0 ? 'success' : 'error'}">
                    <strong>JavaScript Errors Detected:</strong> ${errors.length}<br>
                    ${errors.length > 0 ? '<pre>' + errors.map(e => e.message).join('\n') + '</pre>' : 'No errors found ‚úÖ'}
                </div>
            `;
            document.getElementById('step4').className = 'test-section ' + (errors.length === 0 ? 'success' : 'error');
        }, 1000);

        // Step 5: Individual Product Test
        try {
            const { productTypes } = await import('./src/data/products.js?v=' + Date.now());
            const { createSvgIcon } = await import('./src/components/SvgIcons.js');
            
            let html = '';
            Object.entries(productTypes).forEach(([key, product]) => {
                let icon = '';
                try {
                    switch (key) {
                        case 'brochures': icon = createSvgIcon('brochure'); break;
                        case 'postcards': icon = createSvgIcon('postcard'); break;
                        case 'flyers': icon = createSvgIcon('flyer'); break;
                        case 'bookmarks': icon = createSvgIcon('bookmark'); break;
                        case 'table_tents': icon = createSvgIcon('table_tent'); break;
                        case 'magnets': icon = createSvgIcon('magnet'); break;
                        default: icon = createSvgIcon('businessCard');
                    }
                } catch (e) {
                    icon = `ERROR: ${e.message}`;
                }
                
                html += `
                    <div class="product-test ${key === 'magnets' ? 'magnets' : ''}">
                        <div>${icon}</div>
                        <strong>${product.name}</strong><br>
                        <small>Type: ${product.pricing.type || 'standard'}</small>
                    </div>
                `;
            });
            
            document.getElementById('individual-products').innerHTML = html;
            document.getElementById('step5').className = 'test-section success';
            
        } catch (error) {
            document.getElementById('individual-products').innerHTML = `<div class="error">Individual test failed: ${error.message}</div>`;
            document.getElementById('step5').className = 'test-section error';
        }
    </script>
</body>
</html>