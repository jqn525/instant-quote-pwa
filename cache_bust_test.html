<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Bust Test - Magnets</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        .test-section { 
            background: white;
            margin: 15px 0; 
            padding: 20px; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid green; }
        .error { border-left: 4px solid red; }
        .warning { border-left: 4px solid orange; }
        .info { border-left: 4px solid blue; }
        
        .product-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 15px; 
            margin-top: 15px;
        }
        .product-card { 
            background: white;
            padding: 20px; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            cursor: pointer; 
            text-align: center;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .product-card:hover { 
            border-color: #2563eb; 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }
        .product-card.magnets { 
            background: linear-gradient(145deg, #fff7ed, #fed7aa);
            border-color: #ea580c;
        }
        .product-icon { 
            font-size: 2rem; 
            margin-bottom: 15px; 
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .product-name { 
            margin: 10px 0; 
            font-size: 1.25rem; 
            font-weight: bold;
            color: #1f2937;
        }
        .product-description { 
            color: #6b7280; 
            font-size: 0.9rem; 
            margin-bottom: 10px;
        }
        .pricing-info {
            background: #f3f4f6;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #374151;
        }
        pre { 
            background: #1f2937; 
            color: #e5e7eb;
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto; 
            font-size: 0.9rem;
        }
        .timestamp {
            color: #6b7280;
            font-size: 0.8rem;
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß≤ Cache-Busting Magnets Test</h1>
        <p>Testing simplified magnets with cache invalidation</p>
        <div class="timestamp">Test run at: <span id="timestamp"></span></div>
    </div>
    
    <div id="import-test" class="test-section info">
        <h3>üì¶ Import Test</h3>
        <p>Testing if products.js imports correctly with cache busting...</p>
        <div id="import-result">Loading...</div>
    </div>
    
    <div id="render-test" class="test-section info">
        <h3>üé® Render Test</h3>
        <p>Testing if ProductSelector can render all products including magnets...</p>
        <div id="render-result">Loading...</div>
        <div class="product-grid" id="product-display"></div>
    </div>
    
    <div id="console-test" class="test-section info">
        <h3>üêõ Console Test</h3>
        <p>Checking for JavaScript errors and debug messages...</p>
        <div id="console-result">Loading...</div>
    </div>

    <script type="module">
        // Set timestamp
        document.getElementById('timestamp').textContent = new Date().toLocaleString();
        
        // Capture console logs and errors
        const logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = (...args) => {
            logs.push({ type: 'log', args });
            originalLog.apply(console, args);
        };
        console.error = (...args) => {
            logs.push({ type: 'error', args });
            originalError.apply(console, args);
        };
        console.warn = (...args) => {
            logs.push({ type: 'warn', args });
            originalWarn.apply(console, args);
        };
        
        try {
            // Step 1: Import Test with aggressive cache busting
            const cacheBuster = Date.now() + Math.random();
            const { productTypes } = await import(`./src/data/products.js?v=${cacheBuster}`);
            const { createSvgIcon } = await import(`./src/components/SvgIcons.js?v=${cacheBuster}`);
            const { ProductSelector } = await import(`./src/components/ProductSelector.js?v=${cacheBuster}`);
            
            const products = Object.keys(productTypes);
            const magnetExists = products.includes('magnets');
            const magnetData = productTypes.magnets;
            
            document.getElementById('import-result').innerHTML = `
                <div class="${magnetExists ? 'success' : 'error'}">
                    <strong>Import Results:</strong><br>
                    ‚úì Products imported: ${products.length}<br>
                    ‚úì Product list: ${products.join(', ')}<br>
                    ‚úì Magnets in data: ${magnetExists ? '‚úÖ YES' : '‚ùå NO'}<br>
                    ${magnetData ? `‚úì Magnets pricing type: ${magnetData.pricing.type || 'standard'}<br>` : ''}
                    ${magnetData ? `‚úì Magnets setup fee: $${magnetData.pricing.setupFee || 'N/A'}<br>` : ''}
                    ‚úì SVG icons: Available<br>
                    ‚úì ProductSelector: Available
                </div>
            `;
            document.getElementById('import-test').className = `test-section ${magnetExists ? 'success' : 'error'}`;
            
            // Step 2: Render Test
            const container = document.getElementById('product-display');
            
            let renderedCount = 0;
            let magnetRendered = false;
            
            Object.entries(productTypes).forEach(([key, product]) => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.dataset.productKey = key;
                
                if (key === 'magnets') {
                    card.classList.add('magnets');
                    magnetRendered = true;
                }
                
                // Get icon
                let icon = '';
                try {
                    switch (key) {
                        case 'brochures': icon = createSvgIcon('brochure'); break;
                        case 'postcards': icon = createSvgIcon('postcard'); break;
                        case 'flyers': icon = createSvgIcon('flyer'); break;
                        case 'bookmarks': icon = createSvgIcon('bookmark'); break;
                        case 'table_tents': icon = createSvgIcon('table_tent'); break;
                        case 'magnets': icon = createSvgIcon('magnet'); break;
                        default: icon = createSvgIcon('businessCard');
                    }
                } catch (e) {
                    icon = `<span style="color: red;">‚ùå ${e.message}</span>`;
                }
                
                card.innerHTML = `
                    <div class="product-icon">${icon}</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-description">${product.description}</div>
                    <div class="pricing-info">
                        Type: ${product.pricing.type || 'standard'}<br>
                        ${product.pricing.setupFee ? `Setup: $${product.pricing.setupFee}` : 'Setup: Variable'}
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    document.querySelectorAll('.product-card').forEach(c => c.style.borderColor = '#e5e7eb');
                    card.style.borderColor = '#2563eb';
                    console.log('Selected:', key, product);
                });
                
                container.appendChild(card);
                renderedCount++;
            });
            
            document.getElementById('render-result').innerHTML = `
                <div class="${magnetRendered ? 'success' : 'error'}">
                    <strong>Render Results:</strong><br>
                    ‚úì Cards rendered: ${renderedCount}<br>
                    ‚úì Magnets rendered: ${magnetRendered ? '‚úÖ YES' : '‚ùå NO'}<br>
                    ‚úì All products visible below
                </div>
            `;
            document.getElementById('render-test').className = `test-section ${magnetRendered ? 'success' : 'error'}`;
            
        } catch (error) {
            document.getElementById('import-result').innerHTML = `
                <div class="error">
                    <strong>‚ùå Import Failed:</strong><br>
                    ${error.message}<br>
                    <pre>${error.stack}</pre>
                </div>
            `;
            document.getElementById('import-test').className = 'test-section error';
        }
        
        // Step 3: Console Test (after a delay to capture all logs)
        setTimeout(() => {
            const relevantLogs = logs.filter(log => 
                log.args.some(arg => 
                    String(arg).toLowerCase().includes('magnet') || 
                    String(arg).toLowerCase().includes('product') ||
                    String(arg).toLowerCase().includes('error')
                )
            );
            
            let consoleHtml = '';
            if (relevantLogs.length === 0) {
                consoleHtml = '<div class="success">‚úÖ No relevant console messages (clean run)</div>';
            } else {
                consoleHtml = '<div class="info"><strong>Console Messages:</strong><br>';
                relevantLogs.forEach(log => {
                    const type = log.type.toUpperCase();
                    const message = log.args.map(arg => String(arg)).join(' ');
                    consoleHtml += `<div style="margin: 5px 0; padding: 5px; background: #f9f9f9; border-radius: 3px;">
                        <strong>[${type}]</strong> ${message}
                    </div>`;
                });
                consoleHtml += '</div>';
            }
            
            document.getElementById('console-result').innerHTML = consoleHtml;
            document.getElementById('console-test').className = 'test-section info';
        }, 1000);
    </script>
</body>
</html>