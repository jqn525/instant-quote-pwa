<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test External Products</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { border-color: green; background-color: #f0f8f0; }
        .error { border-color: red; background-color: #f8f0f0; }
    </style>
</head>
<body>
    <h1>External Products Integration Test</h1>
    <div id="test-results"></div>

    <script type="module">
        const results = document.getElementById('test-results');
        
        function addResult(test, success, message) {
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${test}:</strong> ${message}`;
            results.appendChild(div);
        }

        try {
            // Test 1: Import external products
            const { externalProducts } = await import('./src/data/externalProducts.js');
            addResult('External Products Import', true, `Loaded ${Object.keys(externalProducts).length} external products`);
            
            // Test 2: Check magnets structure
            const magnets = externalProducts.magnets;
            if (magnets && magnets.key === 'magnets') {
                addResult('Magnets Structure', true, `Magnets product configured with ${magnets.sizes.length} sizes`);
            } else {
                addResult('Magnets Structure', false, 'Magnets product not found or misconfigured');
            }
            
            // Test 3: Test External Pricing Engine
            const { ExternalPricingEngine } = await import('./src/services/ExternalPricingEngine.js');
            const engine = new ExternalPricingEngine();
            const pricing = engine.calculatePrice(magnets, '2X2', 50);
            addResult('External Pricing Engine', true, `Calculated price: $${pricing.total.toFixed(2)}`);
            
            // Test 4: Test ProductSelector
            const { ProductSelector } = await import('./src/components/ProductSelector.js');
            const { productTypes } = await import('./src/data/products.js');
            
            const container = document.createElement('div');
            const selector = new ProductSelector(container, productTypes, externalProducts, () => {});
            
            if (container.querySelector('.product-category')) {
                addResult('ProductSelector Integration', true, 'Categories rendered successfully');
            } else {
                addResult('ProductSelector Integration', false, 'Categories not rendered');
            }
            
        } catch (error) {
            addResult('Integration Test', false, `Error: ${error.message}`);
            console.error('Test error:', error);
        }
    </script>
</body>
</html>